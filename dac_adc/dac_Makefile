# Makefile for DAC Baby Step
# iCE40 HX1K - Open-source toolchain

PROJECT = dac_sweep
SOURCES = dac_top.v
MEMFILE = ramp.mem

# iCE40 HX1K in VQ100 package
DEVICE = hx1k
PACKAGE = vq100

all: $(PROJECT).bin

# Synthesize
$(PROJECT).json: $(SOURCES) $(MEMFILE)
	yosys -p "synth_ice40 -top top -json $@" $(SOURCES)

# Place and route
$(PROJECT).asc: $(PROJECT).json dac_pins.pcf
	nextpnr-ice40 --$(DEVICE) --package $(PACKAGE) --json $< --pcf dac_pins.pcf --asc $@

# Generate bitstream
$(PROJECT).bin: $(PROJECT).asc
	icepack $< $@

# Program FPGA
prog: $(PROJECT).bin
	iceprog $<

# Clean
clean:
	rm -f $(PROJECT).json $(PROJECT).asc $(PROJECT).bin

.PHONY: all prog clean
